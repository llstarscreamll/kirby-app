<form *ngIf="!enableAdvancedSearch"
      [formGroup]="simpleSearchForm"
      (submit)="onSimpleSearchSubmit()"
      class="simple-search mb-5"
      autocomplete="off">
  <mat-form-field class="w-full">
    <mat-label>Buscar</mat-label>
    <input formControlName="search"
           matInput
           [placeholder]="searchPlaceHolder()"
           type="search" />
    <mat-icon matSuffix>search</mat-icon>
  </mat-form-field>

  <div class="text-right">
    <a (click)="toggleAdvancedSearch()"
       class="open-advanced-search"
       role="button">BÃºsqueda avanzada</a>
  </div>
</form>

<form *ngIf="enableAdvancedSearch"
      [formGroup]="advancedSearchForm"
      class="advanced-search-form mb-5"
      (submit)="onAdvancedSearchSubmitted()"
      autocomplete="off">
  <mat-form-field *ngIf="globalSearch" class="w-full">
    <mat-label>Empleado</mat-label>
    <mat-chip-grid #employeesList aria-label="Employee selection">
      <mat-chip-row *ngFor="let employee of addedEmployees"
                    selectable="true"
                    removable="true"
                    (removed)="removeEmployee(employee)">
        {{ employee.first_name }}
        <mat-icon matChipRemove>cancel</mat-icon>
      </mat-chip-row>
      <input matInput
             #employeeInput
             formControlName="employeesSearch"
             matAutocomplete="auto"
             [matAutocomplete]="employeeAutocomplete"
             [matChipInputFor]="employeesList" />
      <mat-autocomplete #employeeAutocomplete="matAutocomplete"
                        [displayWith]="displayEmployeeFieldValue"
                        (optionSelected)="addEmployee($event)">
        <mat-option *ngFor="let employee of employeesFound.data" [value]="employee"
                    [disabled]="employeeIsSelected(employee)">
          <span>{{ employee.first_name + ' ' + employee.last_name + ' ' + employee.code }}</span>
        </mat-option>
      </mat-autocomplete>
    </mat-chip-grid>
  </mat-form-field>

  <mat-chip-grid *ngIf="globalSearch" class="selected-employees">
    <mat-chip-row *ngFor="let employee of selectedEmployees">
      {{ employee.first_name + ' ' + employee.last_name }}
      <mat-icon matChipRemove (click)="removeEmployee(employee)">
        cancel
      </mat-icon>
    </mat-chip-row>
  </mat-chip-grid>

  <div class="flex flex-col md:flex-row md:gap-4">
    <div class="flex-grow">
      <mat-form-field class="w-full">
        <mat-label>Tipo de novedad</mat-label>
        <input formControlName="noveltyTypesSearch"
               matInput
               [matAutocomplete]="noveltyTypeAutocomplete"
               type="text" />

        <mat-autocomplete #noveltyTypeAutocomplete="matAutocomplete" [displayWith]="displayNoveltyTypeFieldValue">
          <mat-option *ngFor="let noveltyType of noveltyTypesFound?.data" [value]="noveltyType">
            <span>{{ noveltyType.code + ' ' + noveltyType.name }}</span>
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

      <mat-chip-grid *ngIf="selectedNoveltyTypes.length" class="selected-novelty-types block mb-6">
        <mat-chip-row color="primary" *ngFor="let noveltyType of selectedNoveltyTypes">
          {{ noveltyType.code + ' ' + noveltyType.name }}
          <mat-icon matChipRemove (click)="removeNoveltyType(noveltyType)">cancel</mat-icon>
        </mat-chip-row>
      </mat-chip-grid>
    </div>

    <div class="flex-grow">
      <mat-form-field class="w-full">
        <mat-label>Centro de costo</mat-label>
        <input formControlName="costCentersSearch"
               matInput
               [matAutocomplete]="costCenterAutocomplete"
               type="text" />

        <mat-autocomplete #costCenterAutocomplete="matAutocomplete" [displayWith]="displayCostCenterFieldValue">
          <mat-option *ngFor="let costCenter of costCentersFound?.data" [value]="costCenter">
            <span>{{ costCenter.code + ' ' + costCenter.name }}</span>
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

      <mat-chip-grid class="selected-cost-centers block mb-6">
        <mat-chip-row color="primary" *ngFor="let costCenter of selectedCostCenters">
          {{ costCenter.code + ' ' + costCenter.name }}
          <mat-icon matChipRemove (click)="removeCostCenter(costCenter)">
            cancel
          </mat-icon>
        </mat-chip-row>
      </mat-chip-grid>
    </div>
  </div>

  <div class="flex flex-col md:flex-row md:gap-4">
    <mat-form-field class="flex-grow">
      <mat-label>Inicio</mat-label>
      <input formControlName="startAtFrom" matInput type="datetime-local" />
    </mat-form-field>
    <mat-form-field class="flex-grow">
      <mat-label>Fin</mat-label>
      <input formControlName="startAtTo" matInput type="datetime-local" />
    </mat-form-field>
  </div>

  <div class="text-center">
    <button mat-stroked-button type="submit" ngClass.xs="block w-full h-12">Buscar</button>
  </div>
</form>
