<h1 class="inline-block">
  <a routerLink="..">Registros de producci칩n</a> / Crear
</h1>

<div class="card">

  <kirby-api-errors [apiError]="error$ | async" class="block mb-5"></kirby-api-errors>

  <form [formGroup]="form" autocomplete="off">
    <div fxLayout="column" fxLayout.gt-xs="row" fxLayoutGap="0px" fxLayoutGap.gt-xs="20px">
      <mat-form-field fxFlex="grow">
        <mat-label>Empleado</mat-label>
        <input [matAutocomplete]="employeeAutocomplete"
               formControlName="employee"
               matInput />
        <mat-autocomplete #employeeAutocomplete="matAutocomplete"
                          [displayWith]="displayNameValue">
          <mat-option *ngFor="let employee of (paginatedEmployees$ | async).data"
                      [value]="employee">
            <span>{{ employee.first_name + ' ' + employee.last_name + ' ' + employee.code }}</span>
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
    </div>
    <div fxLayout="column" fxLayout.gt-xs="row" fxLayoutGap="0px" fxLayoutGap.gt-xs="20px">
      <mat-form-field fxFlex="grow">
        <mat-label>Producto</mat-label>
        <input [matAutocomplete]="productAutocomplete"
               formControlName="product"
               matInput
               autofocus />
        <mat-autocomplete #productAutocomplete="matAutocomplete"
                          [displayWith]="displayShortNameValue">
          <mat-option *ngFor="let product of products$ | async"
                      [value]="product">
            <span>{{ product.short_name }}</span>
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

      <mat-form-field fxFlex="grow">
        <mat-label>Di치metro (BWG)</mat-label>
        <input matInput type="number" [value]="selectedProduct?.wire_gauge_in_bwg || ''" disabled />
      </mat-form-field>

      <mat-form-field fxFlex="grow">
        <mat-label>Di치metro (mm)</mat-label>
        <input matInput type="number" [value]="selectedProduct?.wire_gauge_in_mm || ''" disabled />
      </mat-form-field>
    </div>

    <div fxLayout="column" fxLayout.gt-xs="row" fxLayoutGap="0px" fxLayoutGap.gt-xs="20px">
      <mat-form-field fxFlex="grow">
        <mat-label>M치quina</mat-label>
        <input [matAutocomplete]="machineAutocomplete"
               formControlName="machine"
               matInput />
        <mat-autocomplete #machineAutocomplete="matAutocomplete"
                          [displayWith]="displayShortNameValue">
          <mat-option *ngFor="let machine of machines$ | async" [value]="machine">
            <span>{{ machine.short_name }}</span>
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

      <mat-form-field fxFlex="grow">
        <mat-label>Cliente</mat-label>
        <input [matAutocomplete]="customerAutocomplete"
               formControlName="customer"
               matInput />
        <mat-autocomplete #customerAutocomplete="matAutocomplete"
                          [displayWith]="displayNameValue">
          <mat-option *ngFor="let customer of customers$ | async"
                      [value]="customer">
            <span>{{ customer.name }}</span>
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

      <mat-form-field fxFlex="grow">
        <mat-label>Lote</mat-label>
        <input formControlName="batch" matInput type="number" min="0" step="1" />
      </mat-form-field>
    </div>

    <div fxLayout="column" fxLayout.gt-xs="row" fxLayoutGap="0px" fxLayoutGap.gt-xs="20px">
      <mat-form-field fxFlex="grow">
        <mat-label>Peso tara (kg)</mat-label>
        <input #tareWeightField formControlName="tare_weight" matInput type="number" step="0.1" min="0" />
      </mat-form-field>

      <mat-form-field fxFlex="grow">
        <mat-label>Peso bruto (kg)</mat-label>
        <input #grossWeightField formControlName="gross_weight" matInput type="number" step="0.1" min="0" />
        <mat-hint *ngIf="readyToConnectToWeighMachine()" align="end">{{ machineValue }}</mat-hint>
      </mat-form-field>

      <mat-form-field fxFlex="grow">
        <mat-label>Peso neto (kg)</mat-label>
        <input matInput type="number" [value]="netWeight()" disabled />
      </mat-form-field>
    </div>

    <div fxLayout="row" fxLayoutGap="20px">
      <button *ngIf="printerIsAvailable()"
              (click)="saveAndPrint()"
              [disabled]="form.invalid || form.disabled"
              mat-raised-button
              color="primary"
              type="submit"
              class="my-3"
              ngClass.xs="block w-full h-12">
        Guardar e imprimir
      </button>

      <button (click)="saveAndCreateOther()"
              [disabled]="form.invalid || form.disabled"
              mat-raised-button
              color="primary"
              type="submit"
              class="my-3"
              ngClass.xs="block w-full h-12">
        Guardar y crear otro
      </button>
    </div>
  </form>

</div>
