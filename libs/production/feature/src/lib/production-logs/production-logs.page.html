<h1>Registros de producción</h1>

<kirby-api-errors [apiError]="errors$ | async"></kirby-api-errors>

<div fxLayout="column"
     fxLayout.gt-xs="row"
     fxLayoutGap="10px"
     fxLayoutGap.gt-xs="20px">
  <a *ngIf="(user$ | async).can('production-logs.create')"
     routerLink="./create"
     mat-stroked-button
     color="primary">
    Crear
  </a>

  <div fxFlex></div>

  <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Opciones">
    <mat-icon>more_vert</mat-icon>
  </button>

  <mat-menu #menu="matMenu">
    <button (click)="exportLogsToCsv(searchForm.value)" mat-menu-item>
      <span>Descargar filtro actual</span>
    </button>
    <button (click)="exportLogsToCsv({})" mat-menu-item>
      <span>Descargar todo</span>
    </button>
  </mat-menu>
</div>

<div class="mt-3">
  <kirby-search-form #searchForm
                     [employees]="(paginatedEmployees$ | async)?.data"
                     [machines]="machines$ | async"
                     [products]="products$ | async"
                     [subCostCenters]="subCostCenters$ | async"
                     (searchEmployees)="searchEmployees($event)"
                     (searchMachines)="searchMachines($event)"
                     (searchProducts)="searchProducts($event)"
                     (searchSubCostCenters)="searchSubCostCenters($event)"
                     (formSubmitted)="searchLogs({ filter: $event })"></kirby-search-form>
</div>

<div class="my-3 responsive-table shadow">
  <table class="table">
    <thead>
      <tr>
        <th>Producto</th>
        <th>Máquina</th>
        <th>Empleado</th>
        <th>Neto <small>(kg)</small></th>
        <th>Fecha de etiqueta</th>
        <th class="w-5"></th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let log of productionLogs$ | async"
          [ngClass]="{'bg-red-100': log.tag === 'Rejected', 'bg-yellow-100': log.tag === 'Error'}">
        <td>{{ log.product?.name }}</td>
        <td>{{ log.machine?.short_name }}</td>
        <td>{{ log.employee?.first_name }}</td>
        <td>{{ log.netWeight() }}</td>
        <td>{{ log.tag_updated_at | date:'MMM d, h:mm a' }}</td>
        <td>
          <a mat-icon-button [routerLink]="[log.id, 'edit']">
            <mat-icon>edit</mat-icon>
          </a>
        </td>
      </tr>
    </tbody>

  </table>
</div>

<div class="text-right">
  <kirby-pagination [pagination]="pagination$ | async" (paginate)="searchLogs($event)">
  </kirby-pagination>
</div>

<div>
  <span class="bg-yellow-100">Error de registro</span>
  <br>
  <span class="bg-red-100">Rechazado</span>
</div>
